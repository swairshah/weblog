<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Swair Shah">
  <title>Handy `date` Util trick for sending metrics from logfile data - A Blog!</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../style.css">
  <!-- Warning: Do not edit this file; it will be overwritten during blog rebuild. -->
  <meta name="description" content="Swair's Blog">
  <meta name="keywords" content="Swair Shah, Math, Computers, Chess, Music">
  <link rel="icon" href="/">
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Mono:400,700,400italic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700|Alegreya+SC:400,700|PT+Mono" rel="stylesheet" type="text/css">
  
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42812812-1']);
      _gaq.push(['_trackPageview']);
  
      (function() {
       var ga = document.createElement('script');
       ga.type = 'text/javascript';
       ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0];
       s.parentNode.insertBefore(ga, s);
       })();
  </script>
</head>
<body>
<!-- Warning: Do not edit this file; it will be overwritten during blog rebuild. -->
<h1 class="blog_title">A Blog!</h1>

<a class="return_to_index" href="../index.html">Archives</a>
<h2 class="post_title">Handy `date` Util trick for sending metrics from logfile data</h2>
<p class="date">August 10, 2013</p>
<!-- begin metadata
title: Handy `date` Util trick for sending metrics from logfile data
date: 2013-08-10 12:21
end metadata -->

<p>There is useful data logged into your webserver/application logs. It may not always be a good idea to send metrics to Graphite or Ganglia directly from your code, if you want to seperate concerns of ops from those of the devs. You may want to create some metrics from existing logfiles. You may want to grep for a certain IP , error message, response time etc and you need this data with the time stamp.</p>
<p>The ‘date’ util provides some handy functionalities which we can use. Say our logs are something like follows:</p>
<pre><code>58.39.130.55 - - [9 Aug 07:21:00] &quot;HEAD / HTTP/1.0&quot; 200 0 &quot;-&quot; &quot;-&quot;
66.249.73.119 - - [9 Aug 07:22:10] &quot;GET /robots.txt HTTP/1.1&quot; 404
143 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)&quot;
66.249.73.119 - - [9 Aug 07:22:19] &quot;HEAD / HTTP/1.1&quot; 200 0 &quot;-&quot; \</code></pre>
<p>If you want to send per minute hits or per min errors, you can have a bash for loop, which will grep for your required param (user agent, 200s, 404s etc) for the last 10 mins, and put it in a script to run as a 10 min cron.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> <span class="kw">((</span> i = 10; i &gt; 0; i-- <span class="kw">))</span>;
<span class="kw">do</span>
    <span class="ot">timestamp=</span><span class="kw">`date</span> +<span class="st">&quot;%d %b %H:%M&quot;</span> -d <span class="st">&quot;-</span><span class="ot">$i</span><span class="st"> min&quot;</span><span class="kw">`</span>
    <span class="ot">epoch=</span><span class="kw">`date</span> +<span class="st">&quot;%s&quot;</span> -d <span class="st">&quot;</span><span class="ot">$i</span><span class="st"> min&quot;</span><span class="kw">`</span>
    <span class="ot">errors=</span><span class="kw">`grep</span> <span class="st">&quot;</span><span class="ot">$timestamp</span><span class="st">&quot;</span> <span class="ot">$logfile</span> <span class="kw">|</span> <span class="kw">grep</span> -i <span class="st">&quot;xml:error&quot;</span> <span class="kw">|</span> <span class="kw">wc</span> -l<span class="kw">`</span>
<span class="kw">done</span></code></pre>
<p>The ‘date’ util can output the date in any format you want it to, pass the format using <code>+&quot; &quot;</code>. You can pass <code>-x min</code> to get (current time-x min). You can get the epoch time (which you’ll need to send data to Graphite server) with +“%s”.</p>
<p>Set this script as a 10 min cron and you have metrics from logfiles!</p>
<!-- Warning!: Do not edit this file; it will be overwritten during blog rebuild. -->
<hr class="footer"/>
<p class="footer">
Copyright &#169; 2012-2014 &ndash; Swair Shah<br>
</p>
</body>
</html>
